library(subsamplerr)
library(subsamplerr)
head(texasSeqMeta)
library(magrittr)
library(aweek)
library(lubridate)
library(dplyr)
texasSeqMeta$epiweek <- paste0((texasSeqMeta$date %>% as.Date() %>% epiyear()), "_", (texasSeqMeta$date %>% as.Date() %>% epiweek()))
texasSeqCount <- texasSeqMeta %>%
dplyr::group_by(location, epiweek) %>%
summarise(total_count=n(), .groups = 'drop') %>%
as.data.frame()
MetroAreas <- texasSeqCount$location %>% unique() %>% sort()
EpiweekS <- texasSeqCount$epiweek %>% unique() %>% sort()
texasSeq <- matrix(0, length(MetroAreas), length(EpiweekS))
rownames(texasSeq) <- MetroAreas
colnames(texasSeq) <- EpiweekS
for (i in 1:nrow(texasSeqCount)) {
texasSeq[texasSeqCount[i, "location"] == MetroAreas, texasSeqCount[i, "epiweek"] == EpiweekS] <- texasSeqCount[i, "total_count"]
}
EpiweekC <- paste0((colnames(texasCase) %>% as.Date() %>% epiyear()), "_", (colnames(texasCase) %>% as.Date() %>% epiweek()))
colnames(texasCase) <- EpiweekC
texasCase <- t(rowsum(t(texasCase), colnames(texasCase)))
texasCase <- texasCase[rownames(texasSeq), colnames(texasSeq)]
plotSequencingPercentage(texasSeq, texasCase)
texasSample <- expectedSampleMatrix(0.006, texasSeq, texasCase)
id <- proportionalSampling(texasSample, texasSeqMeta)
sampleM <- texasSample
seqMeta <- texasSeqCount
samples <- vector()
for(i in 1:nrow(sampleM)){
for(j in 1:ncol(sampleM)){
samples <- c(samples, sample(seqMeta[seqMeta$location == rownames(sampleM)[i] & seqMeta$epiweek == colnames(sampleM)[j], 1], sampleM[i,j], replace = FALSE))
}
}
seqMeta <- texasSeqMeta
samples <- vector()
for(i in 1:nrow(sampleM)){
for(j in 1:ncol(sampleM)){
samples <- c(samples, sample(seqMeta[seqMeta$location == rownames(sampleM)[i] & seqMeta$epiweek == colnames(sampleM)[j], 1], sampleM[i,j], replace = FALSE))
}
}
seqMeta[seqMeta$gisaid_epi_isl == samples, "location"] %>% summary()
seqMeta[seqMeta$gisaid_epi_isl == samples, "location"]
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"]
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% summary()
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table()
proportionalSampling <- function(sampleM, seqMeta, ...){
samples <- vector()
for(i in 1:nrow(sampleM)){
for(j in 1:ncol(sampleM)){
samples <- c(samples, sample(seqMeta[seqMeta$location == rownames(sampleM)[i] & seqMeta$epiweek == colnames(sampleM)[j], 1], sampleM[i,j], replace = FALSE))
}
}
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort()
return(samples)
}
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort()
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort(decreasing = TRUE)
attributes(sampleM)
library(subsamplerr)
library(subsamplerr)
library(subsamplerr)
head(texasSeqMeta)
library(magrittr)
library(aweek)
library(lubridate)
library(dplyr)
texasSeqMeta$epiweek <- paste0((texasSeqMeta$date %>% as.Date() %>% epiyear()), "_", (texasSeqMeta$date %>% as.Date() %>% epiweek()))
texasSeqCount <- texasSeqMeta %>%
dplyr::group_by(location, epiweek) %>%
summarise(total_count=n(), .groups = 'drop') %>%
as.data.frame()
MetroAreas <- texasSeqCount$location %>% unique() %>% sort()
EpiweekS <- texasSeqCount$epiweek %>% unique() %>% sort()
texasSeq <- matrix(0, length(MetroAreas), length(EpiweekS))
rownames(texasSeq) <- MetroAreas
colnames(texasSeq) <- EpiweekS
for (i in 1:nrow(texasSeqCount)) {
texasSeq[texasSeqCount[i, "location"] == MetroAreas, texasSeqCount[i, "epiweek"] == EpiweekS] <- texasSeqCount[i, "total_count"]
}
EpiweekC <- paste0((colnames(texasCase) %>% as.Date() %>% epiyear()), "_", (colnames(texasCase) %>% as.Date() %>% epiweek()))
colnames(texasCase) <- EpiweekC
texasCase <- t(rowsum(t(texasCase), colnames(texasCase)))
texasCase <- texasCase[rownames(texasSeq), colnames(texasSeq)]
plotSequencingPercentage(texasSeq, texasCase)
texasSample <- expectedSampleMatrix(0.006, texasSeq, texasCase)
baseline <- 0.006
seqM <- texasSeq
caseM <- texasCase
for(i in 1:nrow(caseM)){
for(j in 1:ncol(caseM)){
if(ceiling(caseM[i, j]*baseline) < seqM[i, j]){
seqM[i, j] = ceiling(caseM[i, j]*baseline)
}
}
}
View(seqM)
comment(seqM) <- baseline
comment(seqM) <- "baseline"
attributes(seqM)
comment(seqM) <- baseline %>% as.character()
attributes(seqM)
seqM$comment
seqM'$comment'
attributes(seqM)
attributes(seqM)$comment
library(subsamplerr)
library(subsamplerr)
head(texasSeqMeta)
library(magrittr)
library(aweek)
library(lubridate)
library(dplyr)
texasSeqMeta$epiweek <- paste0((texasSeqMeta$date %>% as.Date() %>% epiyear()), "_", (texasSeqMeta$date %>% as.Date() %>% epiweek()))
texasSeqCount <- texasSeqMeta %>%
dplyr::group_by(location, epiweek) %>%
summarise(total_count=n(), .groups = 'drop') %>%
as.data.frame()
MetroAreas <- texasSeqCount$location %>% unique() %>% sort()
EpiweekS <- texasSeqCount$epiweek %>% unique() %>% sort()
texasSeq <- matrix(0, length(MetroAreas), length(EpiweekS))
rownames(texasSeq) <- MetroAreas
colnames(texasSeq) <- EpiweekS
for (i in 1:nrow(texasSeqCount)) {
texasSeq[texasSeqCount[i, "location"] == MetroAreas, texasSeqCount[i, "epiweek"] == EpiweekS] <- texasSeqCount[i, "total_count"]
}
EpiweekC <- paste0((colnames(texasCase) %>% as.Date() %>% epiyear()), "_", (colnames(texasCase) %>% as.Date() %>% epiweek()))
colnames(texasCase) <- EpiweekC
texasCase <- t(rowsum(t(texasCase), colnames(texasCase)))
texasCase <- texasCase[rownames(texasSeq), colnames(texasSeq)]
plotSequencingPercentage(texasSeq, texasCase)
texasSample <- expectedSampleMatrix(0.006, texasSeq, texasCase)
id <- proportionalSampling(texasSample, texasSeqMeta)
sampleM <- texasSample
seqMeta <- texasSeqMeta
samples <- vector()
for(i in 1:nrow(sampleM)){
for(j in 1:ncol(sampleM)){
samples <- c(samples, sample(seqMeta[seqMeta$location == rownames(sampleM)[i] & seqMeta$epiweek == colnames(sampleM)[j], 1], sampleM[i,j], replace = FALSE))
}
}
print(paste0("Given the basline equals ", attributes(sampleM)$comment), ", ", sum(rowSums(sampleM)), " genomes are sampled.")
attributes(sampleM)$comment
print(paste0("Given the basline equals ", attributes(sampleM)$comment, ", ", sum(rowSums(sampleM)), " genomes are sampled.")
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort(decreasing = TRUE)
paste0("Given the basline equals ", (attributes(sampleM)$comment), ", ", sum(rowSums(sampleM)), " genomes are sampled.")
print(paste0("Given the basline equals ", (attributes(sampleM)$comment), ", ", sum(rowSums(sampleM)), " genomes are sampled."))
paste0("Given the basline equals ", (attributes(sampleM)$comment), ", ", sum(rowSums(sampleM)), " genomes are sampled.")
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort(decreasing = TRUE)
library(subsamplerr)
library(subsamplerr)
head(texasSeqMeta)
library(magrittr)
library(aweek)
library(lubridate)
library(dplyr)
texasSeqMeta$epiweek <- paste0((texasSeqMeta$date %>% as.Date() %>% epiyear()), "_", (texasSeqMeta$date %>% as.Date() %>% epiweek()))
texasSeqCount <- texasSeqMeta %>%
dplyr::group_by(location, epiweek) %>%
summarise(total_count=n(), .groups = 'drop') %>%
as.data.frame()
MetroAreas <- texasSeqCount$location %>% unique() %>% sort()
EpiweekS <- texasSeqCount$epiweek %>% unique() %>% sort()
texasSeq <- matrix(0, length(MetroAreas), length(EpiweekS))
rownames(texasSeq) <- MetroAreas
colnames(texasSeq) <- EpiweekS
for (i in 1:nrow(texasSeqCount)) {
texasSeq[texasSeqCount[i, "location"] == MetroAreas, texasSeqCount[i, "epiweek"] == EpiweekS] <- texasSeqCount[i, "total_count"]
}
EpiweekC <- paste0((colnames(texasCase) %>% as.Date() %>% epiyear()), "_", (colnames(texasCase) %>% as.Date() %>% epiweek()))
colnames(texasCase) <- EpiweekC
texasCase <- t(rowsum(t(texasCase), colnames(texasCase)))
texasCase <- texasCase[rownames(texasSeq), colnames(texasSeq)]
plotSequencingPercentage(texasSeq, texasCase)
texasSample <- expectedSampleMatrix(0.006, texasSeq, texasCase)
id <- proportionalSampling(texasSample, texasSeqMeta)
document()
library(devtools)
document()
document()
library(subsamplerr)
library(subsamplerr)
head(texasSeqMeta)
library(magrittr)
library(aweek)
library(lubridate)
library(dplyr)
texasSeqMeta$epiweek <- paste0((texasSeqMeta$date %>% as.Date() %>% epiyear()), "_", (texasSeqMeta$date %>% as.Date() %>% epiweek()))
texasSeqCount <- texasSeqMeta %>%
dplyr::group_by(location, epiweek) %>%
summarise(total_count=n(), .groups = 'drop') %>%
as.data.frame()
MetroAreas <- texasSeqCount$location %>% unique() %>% sort()
EpiweekS <- texasSeqCount$epiweek %>% unique() %>% sort()
texasSeq <- matrix(0, length(MetroAreas), length(EpiweekS))
rownames(texasSeq) <- MetroAreas
colnames(texasSeq) <- EpiweekS
for (i in 1:nrow(texasSeqCount)) {
texasSeq[texasSeqCount[i, "location"] == MetroAreas, texasSeqCount[i, "epiweek"] == EpiweekS] <- texasSeqCount[i, "total_count"]
}
EpiweekC <- paste0((colnames(texasCase) %>% as.Date() %>% epiyear()), "_", (colnames(texasCase) %>% as.Date() %>% epiweek()))
colnames(texasCase) <- EpiweekC
texasCase <- t(rowsum(t(texasCase), colnames(texasCase)))
texasCase <- texasCase[rownames(texasSeq), colnames(texasSeq)]
plotSequencingPercentage(texasSeq, texasCase)
texasSample <- expectedSampleMatrix(0.006, texasSeq, texasCase)
id <- proportionalSampling(texasSample, texasSeqMeta)
sampleM <- texasSample
seqMeta <- texasSeqMeta
samples <- vector()
for(i in 1:nrow(sampleM)){
for(j in 1:ncol(sampleM)){
samples <- c(samples, sample(seqMeta[seqMeta$location == rownames(sampleM)[i] & seqMeta$epiweek == colnames(sampleM)[j], 1], sampleM[i,j], replace = FALSE))
}
}
paste0("Given the basline equals ", (attributes(sampleM)$comment), ", ", sum(rowSums(sampleM)), " genomes are sampled.") %>% print()
tb <- seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort(decreasing = TRUE)
print(tb)
paste0("Given the basline equals ", (attributes(sampleM)$comment), ", ", sum(rowSums(sampleM)), " genomes are sampled.") %>% print()
seqMeta[is.element(seqMeta$gisaid_epi_isl, samples), "location"] %>% table() %>% sort(decreasing = TRUE) %>% print()
document()
library(subsamplerr)
document()
library(subsamplerr)
